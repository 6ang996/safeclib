<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>safec: Safe C Library - README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">safec
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">Safe C Library - ISO TR24731 Bounds Checking Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Safe C Library - README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>:toc:</p>
<h2>Copying </h2>
<p>This project's licensing restrictions are documented in the file 'COPYING' under the root directory of this release. Basically it's MIT licensed.</p>
<h2>Overview </h2>
<p>This library implements the secure C11 Annex K functions on top of most libc implementations, which are missing from them.</p>
<p>The ISO TR24731 Bounds Checking Interface documents indicate that the key motivation for the new specification is to help mitigate the ever increasing security attacks, specifically the buffer overrun.</p>
<p>The rationale document says ``Buffer overrun attacks continue to be a security problem. Roughly 10% of vulnerability reports cataloged by CERT from 01/01/2005 to 07/01/2005 involved buffer overflows. Preventing buffer overruns is the primary, but not the only, motivation for this technical report.''</p>
<p>The rationale document continues ``that these only mitigate, that is lessen, security problems. When used properly, these functions decrease the danger buffer overrun attacks. Source code may remain vulnerable due to other bugs and security issues. The highest level of security is achieved by building in layers of security utilizing multiple strategies.''</p>
<p>.The rationale document lists the following key points for TR24731:</p><ul>
<li>Guard against overflowing a buffer</li>
<li>Do not produce unterminated strings</li>
<li>Do not unexpectedly truncate strings</li>
<li>Provide a library useful to existing code</li>
<li>Preserve the null terminated string datatype</li>
<li>Only require local edits to programs</li>
<li>Library based solution</li>
<li>Support compile-time checking</li>
<li>Make failures obvious</li>
<li>Zero buffers, null strings</li>
<li>Runtime-constraint handler mechanism</li>
<li>Support re-entrant code</li>
<li>Consistent naming scheme</li>
<li>Have a uniform pattern for the function parameters and return type</li>
<li>Deference to existing technology</li>
</ul>
<p>and the following can be added...</p>
<ul>
<li>provide a library of functions with like behavior</li>
<li>provide a library of functions that promote and increase code safety and security</li>
<li>provide a library of functions that are efficient</li>
</ul>
<p>The C11 Standard adopted many of these points, and added some secure _s variants in the Annex K. The Microsoft Windows/MINGW secure API did the same, but deviated in some functions from the standard. Besides Windows only Android's Bionic and Embarcadero implemented this C11 secure Annex K API so far. They are still missing from glibc, musl, FreeBSD and DragonFly libc, OpenBSD libc, newlib, dietlibc, uClibc, minilibc.</p>
<h2>Design Considerations </h2>
<p>This library implements since 3.0 all functions defined in the specifications. Included in the library are extensions to the specification to provide a complementary set of functions with like behavior.</p>
<p>This library is meant to be used on top of all the existing libc's which miss the secure C11 functions. Of course tighter integration into the system libc would be better, esp. with the printf, scanf and IO functions. See the seperate <a class="el" href="d7/d17/libc-overview_8md.html">libc-overview.md</a> document.</p>
<p>Austin Group Review of ISO/IEC WDTR 24731 <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1106.txt">http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1106.txt</a></p>
<p>C11 standard (ISO/IEC 9899:2011) <a href="http://en.cppreference.com/w/c">http://en.cppreference.com/w/c</a></p>
<p>Stackoverflow discussion: <a href="https://stackoverflow.com/questions/372980/do-you-use-the-tr-24731-safe-functions">https://stackoverflow.com/questions/372980/do-you-use-the-tr-24731-safe-functions</a></p>
<p>=== Use of errno</p>
<p>The TR24731 specification says an implementation may set errno for the functions deﬁned in the technical report, but is not required to. This library does not set errno. The library does use errno return codes as required by functional APIs. Specific Safe C String and Safe C Memory errno codes are defined in the safe_errno.h file.</p>
<p>=== Runtime-constraints</p>
<p>Per the spec, the library verifies that the calling program does not violate the function's runtime-constraints. If a runtime-constraint is violated, the library calls the currently registered runtime-constraint handler.</p>
<p>Per the spec, multiple runtime-constraint violations in the same call to a library function result in only one call to the runtime-constraint handler. The first violation encountered invokes the runtime-constraint handler.</p>
<p>The runtime-constraint handler might not return. If the handler does return, the library function whose runtime-constraint was violated returns an indication of failure as given by the function’s return.</p>
<p>rsize_t:: The specification defines a new type. This type, rsize_t, is conditionally defined in the <a class="el" href="db/d69/safe__lib_8h.html">safe_lib.h</a> header file.</p>
<p>RSIZE_MAX:: The specification defines the macro RSIZE_MAX which expands to a value of type rsize_t. The specification uses RSIZE_MAX for both the string functions and the memory functions. This implementation defines two macros: RSIZE_MAX_STR and RSIZE_MAX_MEM. RSIZE_MAX_STR defines the range limit for the safe string functions. RSIZE_MAX_MEM defines the range limit for the safe memory functions. The point is that string limits can and should be different from memory limits.</p>
<p>=== Header Files</p>
<p>The specification states the various functions would be added to existing Standard C header files: stdio.h, string.h, etc. This implementation separates the memory related functions into the <a class="el" href="d8/d03/safe__mem__lib_8h.html">safe_mem_lib.h</a> header and the string related functions into the safe_str_lib.h header. You can optionally use the <a class="el" href="db/d69/safe__lib_8h.html">safe_lib.h</a> header to include also non str/mem functions.</p>
<p>The make file builds a single library libsafec-VERSION.a and .so in the src/.libs directory. Built but not installed are also libmemprims, libsafeccore and libstdunsafe.</p>
<p>It is possible to split the make such that a separate safe_mem_lib.so and safe_str_lib.so are built. It is also possible to integrate the prototypes into the Standard C header files, but that may require changes to your development tool chain.</p>
<h2>Userspace Library </h2>
<p>The build system for the userspace library is the well known <em>GNU build system</em>, a.k.a. Autotools. This system is well understood and supported by many different platforms and distributions which should allow this library to be built on a wide variety of platforms. See the xref:tested-platforms[``Tested Platforms''] section for details on what platforms this library was tested on during its development.</p>
<p>=== Building</p>
<p>For those familiar with autotools you can probably skip this part. For those not and want to get right to building the code see below. And, for those that need additional information see the 'INSTALL' file in the same directory.</p>
<h2>.To build you do the following: </h2>
<p>prompt$ ./build-tools/autogen.sh prompt$ ./configure </p><h2>prompt$ make </h2>
<p>'autogen.sh' only needs to be run if you are building from the git repository. Optionally, you can do ``make check'' if you want to run the unit tests.</p>
<p>=== Installing</p>
<p>Installation must be preformed by <code>root</code>, an `Administrator' on most systems. The following is used to install the library. </p><hr/>
 <h2>prompt$ sudo make install </h2>
<h2>Safe Linux Kernel Module </h2>
<p>The build for the kernel module has not been integrated into the autotools build infrastructure. Consequently, you have to run a different makefile to build the kernel module.</p>
<p>=== Building</p>
<h2>.To build do the following: </h2>
<p>prompt$ ./configure </p><h2>prompt$ make -f Makefile.kernel </h2>
<p>This assumes you are compiling on a Linux box and this makefile supports the standard kernel build system infrastructure documented in: &lt;linux-kernel-src-tree&gt;/Documentation/kbuild/modules.txt</p>
<p>NOTE: If you build the kernel module then wish to build the userspace library or vice versa you will need to do a +make clean+ otherwise a +make check+ will fail to build.</p>
<p>=== Installing</p>
<p>The kernel module will be found at the root of the source tree called 'slkm.ko'. The file 'testslkm.ko' are the unit tests run on the userspace library but in Linux kernel module form to verify functionality within the kernel.</p>
<p>[[tested-platforms]] </p><h2>Tested Platforms </h2>
<p>.The library has been tested on the following systems</p><ul>
<li>Mac OS X 10.6-11 w/ Apple developer tools and macports (gcc+clang)</li>
<li>Linux Debian 10 amd64 glibc 2.24</li>
<li>Linux Void amd64 musl-1.1.16</li>
<li>x86_64-w64-mingw32, i686-w64-mingw32 cross-compiled and tested under wine</li>
<li>i386-mingw32 cross-compiled and tested under wine</li>
<li>cygwin32 gcc (newlib)</li>
<li>cygwin64 gcc -std=c99 (newlib)</li>
<li>freebsd 10.3 amd64</li>
<li>User Mode Linux (UML), Linux kernel version v3.5.3 w/ Debian Squeeze rootfs</li>
</ul>
<h2>Known Issues </h2>
<ol type="1">
<li>If you are building the library from the git repository you will have to first run build-tools/autogen.sh which runs autoreconf to ``install'' the autotools files and create the configure script. On Mac OSX you may see a warning about ``AC_FOREACH is obsolete'' this can be ignored as the library will still build correctly.</li>
</ol>
<p>[bibliography] .References</p><ul>
<li>[[[1]]] Programming languages, their environments and system software interfaces, Extensions to the C Library, Part I: Bounds-checking interfaces, ISO/IEC TR 24731-1.</li>
<li>[[[2]]] Rationale for TR 24731 Extensions to the C Library Part I: Bounds-checking interfaces, ISO/IEC JTC1 SC22 WG14 N1225.</li>
<li>[[[3]]] The Open Group Base Specifications Issue 7 <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html">http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html</a></li>
<li>[[[4]]] CERT C Secure Coding Standard <a href="https://www.securecoding.cert.org/confluence/display/seccode/CERT+C+Secure+Coding+Standard">https://www.securecoding.cert.org/confluence/display/seccode/CERT+C+Secure+Coding+Standard</a></li>
<li>[[[5]]] C11 Standard (ISO/IEC 9899:2011) Annex K </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated for Safe C Library 30082017.216-g2422a2 3.0
by <a href="http://www.doxygen.org/index.html">doxygen</a>
</small></address></body></html>
